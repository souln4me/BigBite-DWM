<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Bite - Productos</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Icono -->
    <link rel="icon" type="image/png" sizes="32x32" href="img/logo/icon.png">

    <!-- CSS -->
    <link rel="stylesheet" href="css/productos.css">
    <link rel="stylesheet" href="css/navbar.css">
</head>

<body class="d-flex flex-column min-vh-100">
    <div id="navbar-placeholder"></div>

    <main class="flex-grow-1">
        <!-- Contenido principal -->
        <div class="container mt-4">
            <h1 class="text-center mb-4">Nuestros Productos</h1>

            <!-- Filtros -->
            <div class="mb-4 text-center">
                <h5 class="mb-3">Filtrar por categoría:</h5>
                <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
                    <button class="btn btn-outline-dark filter-btn active" data-category="todos">Todos</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="combos">Combos</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="hamburguesas">Hamburguesas</button>
                    <button class="btn btn-outline-dark filter-btn"
                        data-category="especialidades">Especialidades</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="bebidas">Bebidas</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="otros">Otros</button>
                </div>
            </div>

            <hr class="mb-4">

            <div id="no-products-message" class="mt-5 text-center hidden">
                <h4>No hay productos disponibles en esta categoría</h4>
            </div>

            <!-- Cards -->
            <div class="row justify-content-center" id="products-container">

                <!-- Producto 1 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa Clásica.jpeg" class="card-img-top"
                                alt="Hamburguesa Clásica">
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan brioche artesanal, Carne de res 150g, Queso cheddar, Lechuga fresca, Tomate,
                                    Salsa Big Bite
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa Clásica</h5>
                            <p class="card-text">$8.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 2 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Papas Fritas Medianas.jpeg" class="card-img-top"
                                alt="Papas Fritas Medianas">
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Papas seleccionadas, Aceite vegetal premium, Sal marina
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Papas Fritas Medianas</h5>
                            <p class="card-text">$5.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 3 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos unavailable-product">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Familiar.jpeg" class="card-img-top" alt="Combo Familiar">
                            <div class="unavailable-overlay">No disponible</div>
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    4 Hamburguesas Clásicas + 2 Papas Fritas Grandes + 4 Bebidas 350cc + 4 Postres de la
                                    casa
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-danger">Combo Familiar</h5>
                            <p class="card-text text-decoration-line-through">$29.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 4 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card bebidas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/CocaCola350cc.jpeg" class="card-img-top"
                                alt="Coca Cola Original 350cc">
                            <div class="ingredients-overlay">
                                <h6>Información:</h6>
                                <div class="ingredients-list">
                                    Refresco de cola, Presentación: 350ml, Servida bien fría
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Coca Cola Original 350cc</h5>
                            <p class="card-text">$1.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 5 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card bebidas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/SpriteZero350cc.jpeg" class="card-img-top" alt="Sprite Zero 350cc">
                            <div class="ingredients-overlay">
                                <h6>Información:</h6>
                                <div class="ingredients-list">
                                    Refresco de lima-limón, Cero azúcar, Presentación: 350ml, Servida bien fría
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Sprite Zero 350cc</h5>
                            <p class="card-text">$1.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 6 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa Italiana Gourmet.jpeg" class="card-img-top"
                                alt="Hamburguesa Italiana Gourmet">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan de hamburguesa, Carne picada de ternera 600g, Queso Mozzarella, Tomate,
                                    Albahaca, Tapenade, Rúcula
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa Italiana Gourmet</h5>
                            <p class="card-text">$12.900</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 7 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Empanaditas de Queso.jpeg" class="card-img-top"
                                alt="Empanaditas de Queso">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Masa artesanal, queso mantecoso, sal, aceite vegetal
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Empanaditas de Queso</h5>
                            <p class="card-text">$4.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 8 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Papas Fritas Grandes.jpeg" class="card-img-top"
                                alt="Papas Fritas Grandes">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Papas seleccionadas, Aceite vegetal premium, Sal marina
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Papas Fritas Grandes</h5>
                            <p class="card-text">$7.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 9 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Clásico.jpg" class="card-img-top" alt="Combo Clásico">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Hamburguesa Clásica + Papas Fritas Medianas + Coca Cola Original 350cc
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Clásico</h5>
                            <p class="card-text card-price">
                                <span class="old-price">$14.990</span>
                                <span class="new-price">$7.990</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Producto 10 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Papas Bebida.jpeg" class="card-img-top"
                                alt="Combo Papas Bebida">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Papas Fritas Medianas + Bebida 350cc a elección
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Papas + Bebida</h5>
                            <p class="card-text">$8.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 11 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo BBQ.jpg" class="card-img-top" alt="Combo BBQ">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Hamburguesa BBQ + Papas Fritas Medianas + Bebida 350cc a elección
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo BBQ</h5>
                            <p class="card-text">$15.290</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 12 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Empanaditas Papas.jpg" class="card-img-top"
                                alt="Combo Empanaditas Papas">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Papas Fritas Grandes + Empanaditas de Queso
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Empanaditas + Papas</h5>
                            <p class="card-text">$10.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 13 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa BBQ.jpeg" class="card-img-top" alt="Hamburguesa BBQ">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan brioche artesanal, Carne de res 150g, Queso cheddar, Tomate, Salsa BBQ casera
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa BBQ</h5>
                            <p class="card-text">$8.990</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- Barra de Resumen de Pedido -->
    <div id="order-summary-bar" class="d-none">
        <div class="container">
            <div class="row align-items-center">
                <div id="order-summary-left" class="col-md-8">
                    <!-- Aquí se mostrarán los productos -->
                </div>
                <div class="col-md-4 text-end">
                    <button id="go-to-cart-btn" class="btn btn-success btn-lg" href="carrito_de_compras.html">
                        <i class="bi bi-cart3 me-1"></i> Ir al Carrito
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="productModal">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="row">
                        <!-- Imagen grande a la izquierda -->
                        <div class="col-md-6">
                            <img id="modalImage" src="" class="img-fluid" alt="">
                        </div>
                        <!-- Información a la derecha -->
                        <div class="col-md-6 p-4">
                            <button type="button" class="btn-close float-end" data-bs-dismiss="modal"></button>
                            <h3 id="modalTitle"></h3>
                            <h4 id="modalPrice" class="modal-price mb-2"></h4>
                            <h6 class="availability mb-3">Disponible</h6>
                            <p id="modalIngredients"></p>
                            <!-- Aquí van los extras -->
                            <div id="modalExtras"></div>
                            <button class="btn btn-primary w-100 mt-3 cart-btn">
                                <i class="bi bi-cart3 me-2"></i> Agregar al carrito
                            </button>
                            <img src="img/logo/BIG BITE fulls.png" class="img-fluid mt-3 img-logo-modal"
                                alt="Big Bite Logo">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script>
        // ==============
        // 1. NAVBAR Y FOOTER
        // ==============
        // Cargar navbar
        fetch("components/navbar.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("navbar-placeholder").innerHTML = data;

                // Detectar página actual y marcar enlace activo
                const currentPage = window.location.pathname.split("/").pop();
                const links = document.querySelectorAll("nav a");

                links.forEach(link => {
                    const href = link.getAttribute("href");
                    if (href && currentPage.includes(href.replace('./', ''))) {
                        link.classList.add("active");
                    }
                });
                // Usuario registrado?
                const perfilLink = document.getElementById('perfil-link');

                perfilLink.addEventListener('click', (e) => {
                    const usuarioLogueado = localStorage.getItem('usuarioLogueado'); // ejemplo

                    if (!usuarioLogueado) {
                        // No está logueado → redirigir a registro
                        e.preventDefault();
                        window.location.href = 'register.html';
                    }
                    // Si está logueado, deja que vaya a perfil_usuario.html
                });
            });

        fetch("components/footer.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("footer-placeholder").innerHTML = data;
            });

        // ==============
        // 2. PRODUCTOS, MODAL Y CARRITO
        // ==============
        document.addEventListener('DOMContentLoaded', () => {
            const modalElement = document.getElementById('productModal');
            const bsModal = new bootstrap.Modal(modalElement);
            const goToCartBtn = document.getElementById('go-to-cart-btn');
            const productCards = document.querySelectorAll('.product-card');
            const orderBar = document.getElementById('order-summary-bar');
            const leftColumn = document.getElementById('order-summary-left');
            const noProductsMessage = document.getElementById('no-products-message');

            // cart: array of unique items { id?, name, price (number), quantity }
            // source of truth is localStorage 'carrito'
            function loadCart() {
                try {
                    return JSON.parse(localStorage.getItem('carrito')) || [];
                } catch (e) {
                    return [];
                }
            }
            function saveCart(cart) {
                localStorage.setItem('carrito', JSON.stringify(cart));
                // lanzar custom event para debug interno (opcional)
                window.dispatchEvent(new Event('cart-updated'));
            }

            // Ensure cart items are unique (by name)
            function addToCart(productName, productPrice, productImage) {
                const cart = loadCart();
                const existing = cart.find(i => i.name === productName);
                if (existing) {
                    existing.quantity = (existing.quantity || 1) + 1;
                } else {
                    cart.push({ name: productName, price: productPrice, quantity: 1, image: productImage });
                }
                saveCart(cart);
                updateOrderSummary();
            }

            // price helpers
            function parsePriceString(s) { return parseInt((s || '').replace(/\D/g, ''), 10) || 0; }
            function formatPrice(n) { return '$' + n.toLocaleString('es-CL'); }

            // ---------------------- FILTERS ----------------------
            const filterButtons = document.querySelectorAll('.filter-btn');
            const productCardsArr = Array.from(productCards);
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const cat = btn.dataset.category;
                    let visible = 0;
                    productCardsArr.forEach(card => {
                        if (cat === 'todos' || card.classList.contains(cat)) {
                            card.classList.remove('d-none');
                            visible++;
                        } else {
                            card.classList.add('d-none');
                        }
                    });
                    if (visible === 0) {
                        noProductsMessage.classList.remove('d-none');
                    } else {
                        noProductsMessage.classList.add('d-none');
                    }
                });
            });

            // ---------------------- ORDER SUMMARY ----------------------
            function updateOrderSummary() {
                const cart = loadCart();
                if (!cart || cart.length === 0) {
                    orderBar.classList.add('d-none');
                    return;
                }
                // aggregate by name
                const agg = {};
                let subtotal = 0;
                cart.forEach(it => {
                    const qty = it.quantity || 1;
                    if (!agg[it.name]) agg[it.name] = { ...it };
                    else agg[it.name].quantity = (agg[it.name].quantity || 0) + qty;
                    subtotal += (it.price || 0) * qty;
                });

                let text = '';
                for (const [name, item] of Object.entries(agg)) {
                    text += `${item.quantity}x ${name}, `;
                }
                text = text.replace(/, $/, '');
                leftColumn.innerHTML = `
                    <strong>${text}</strong> |
                    <span class="order-total">Subtotal: ${formatPrice(subtotal)}</span>
                `;
                orderBar.classList.remove('d-none');
            }

            // ---------------------- MODAL / ADD ----------------------
            productCards.forEach(card => {
                card.setAttribute('tabindex', card.getAttribute('tabindex') || '0');
                card.addEventListener('click', function () {
                    if (this.classList.contains('unavailable-product')) return;
                    const title = this.querySelector('.card-title').textContent.trim();
                    const newPriceEl = this.querySelector('.new-price');
                    const priceText = newPriceEl ? newPriceEl.textContent : this.querySelector('.card-text').textContent;
                    const price = parsePriceString(priceText);
                    const image = this.querySelector('.card-img-top').src;
                    const ingredientsOverlay = this.querySelector('.ingredients-overlay');
                    const ingredientsHTML = ingredientsOverlay ? ingredientsOverlay.innerHTML : '';
                    document.getElementById('modalTitle').textContent = title;
                    document.getElementById('modalPrice').textContent = priceText;
                    document.getElementById('modalImage').src = image;
                    document.getElementById('modalIngredients').innerHTML = ingredientsHTML.replace('<div class="view-product">Ver producto</div>', '');

                    // extras example for hamburguesas
                    if (this.classList.contains('hamburguesas')) {
                        document.getElementById('modalExtras').innerHTML = `
                            <div class="mb-3">
                                <h6>Extras disponibles:</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="extraQueso">
                                    <label class="form-check-label" for="extraQueso">Queso extra (+$1.000)</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="extraTocino">
                                    <label class="form-check-label" for="extraTocino">Tocino extra (+$1.800)</label>
                                </div>
                            </div>`;
                    } else {
                        document.getElementById('modalExtras').innerHTML = '';
                    }

                    const addBtn = modalElement.querySelector('.btn-primary');
                    addBtn.onclick = () => addToCart(title, price, image);
                    bsModal.show();
                });

                card.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });

            // ---------------------- GO TO CART ----------------------
            goToCartBtn.addEventListener('click', () => {
                window.location.href = 'carrito_de_compras.html';
            });

            // ---------------------- STORAGE SYNC ----------------------
            // Update summary when other tab/page modifies localStorage
            window.addEventListener('storage', (ev) => {
                if (ev.key === 'carrito') updateOrderSummary();
            });
            // also refresh on focus (user may have changed cart in other tab)
            window.addEventListener('visibilitychange', () => {
                if (!document.hidden) updateOrderSummary();
            });

            // init
            updateOrderSummary();
        });

    </script>

</body>

</html>