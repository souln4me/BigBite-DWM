<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Big Bite - Productos</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Icono -->
  <link rel="icon" type="image/png" sizes="32x32" href="img/logo/icon.png">

  <!-- CSS -->
  <link rel="stylesheet" href="css/productos.css">
  <link rel="stylesheet" href="css/navbar.css">
</head>
<body class="d-flex flex-column min-vh-100">
    <div id="navbar-placeholder"></div>

    <main class="flex-grow-1">
        <!-- Contenido principal -->
        <div class="container mt-4">
            <h1 class="text-center mb-4">Nuestros Productos</h1>

            <!-- Filtros -->
            <div class="mb-4 text-center">
                <h5 class="mb-3">Filtrar por categoría:</h5>
                <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
                    <button class="btn btn-outline-dark filter-btn active" data-category="todos">Todos</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="combos">Combos</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="hamburguesas">Hamburguesas</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="especialidades">Especialidades</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="bebidas">Bebidas</button>
                    <button class="btn btn-outline-dark filter-btn" data-category="otros">Otros</button>
                </div>
            </div>

            <hr class="mb-4">

            <div id="no-products-message" class="mt-5 text-center hidden">
                <h4>No hay productos disponibles en esta categoría</h4>
            </div>

            <!-- Cards -->
            <div class="row justify-content-center" id="products-container">
                
                <!-- Producto 1 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa Clásica.jpeg" class="card-img-top" alt="Hamburguesa Clásica">
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan brioche artesanal, Carne de res 150g, Queso cheddar, Lechuga fresca, Tomate, Salsa Big Bite
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa Clásica</h5>
                            <p class="card-text">$8.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 2 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Papas Fritas Medianas.jpeg" class="card-img-top" alt="Papas Fritas Medianas">
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Papas seleccionadas, Aceite vegetal premium, Sal marina
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Papas Fritas Medianas</h5>
                            <p class="card-text">$5.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 3 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos unavailable-product">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Familiar.jpeg" class="card-img-top" alt="Combo Familiar">
                            <div class="unavailable-overlay">No disponible</div>
                            <!-- Overlay de ingredientes (solo en la imagen) -->
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    4 Hamburguesas Clásicas + 2 Papas Fritas Grandes + 4 Bebidas 350cc + 4 Postres de la casa
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-danger">Combo Familiar</h5>
                            <p class="card-text text-decoration-line-through">$29.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 4 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card bebidas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/CocaCola350cc.jpeg" class="card-img-top" alt="Coca Cola Original 350cc">
                            <div class="ingredients-overlay">
                                <h6>Información:</h6>
                                <div class="ingredients-list">
                                    Refresco de cola, Presentación: 350ml, Servida bien fría
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Coca Cola Original 350cc</h5>
                            <p class="card-text">$1.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 5 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card bebidas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/SpriteZero350cc.jpeg" class="card-img-top" alt="Sprite Zero 350cc">
                            <div class="ingredients-overlay">
                                <h6>Información:</h6>
                                <div class="ingredients-list">
                                    Refresco de lima-limón, Cero azúcar, Presentación: 350ml, Servida bien fría
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Sprite Zero 350cc</h5>
                            <p class="card-text">$1.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 6 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa Italiana Gourmet.jpeg" class="card-img-top" alt="Hamburguesa Italiana Gourmet">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan de hamburguesa, Carne picada de ternera 600g, Queso Mozzarella, Tomate, Albahaca, Tapenade, Rúcula
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa Italiana Gourmet</h5>
                            <p class="card-text">$12.900</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 7 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Empanaditas de Queso.jpeg" class="card-img-top" alt="Empanaditas de Queso">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Masa artesanal, queso mantecoso, sal, aceite vegetal
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Empanaditas de Queso</h5>
                            <p class="card-text">$4.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 8 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card otros">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Papas Fritas Grandes.jpeg" class="card-img-top" alt="Papas Fritas Grandes">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Papas seleccionadas, Aceite vegetal premium, Sal marina
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Papas Fritas Grandes</h5>
                            <p class="card-text">$7.990</p>
                        </div>
                    </div>
                </div>

                <!-- Producto 9 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Clásico.jpg" class="card-img-top" alt="Combo Clásico">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Hamburguesa Clásica + Papas Fritas Medianas + Coca Cola Original 350cc
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Clásico</h5>
                            <p class="card-text card-price">
                            <span class="old-price">$14.990</span>
                            <span class="new-price">$7.990</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Producto 10 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Papas Bebida.jpeg" class="card-img-top" alt="Combo Papas Bebida">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Papas Fritas Medianas + Bebida 350cc a elección
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Papas + Bebida</h5>
                            <p class="card-text">$8.990</p>
                    </div>
                </div>
                </div>

                <!-- Producto 11 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo BBQ.jpg" class="card-img-top" alt="Combo BBQ">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Hamburguesa BBQ + Papas Fritas Medianas + Bebida 350cc a elección
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo BBQ</h5>
                            <p class="card-text">$15.290</p>
                    </div>
                </div>
                </div>

                <!-- Producto 12 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card combos">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Combo Empanaditas Papas.jpg" class="card-img-top" alt="Combo Empanaditas Papas">
                            <div class="ingredients-overlay">
                                <h6>Combo incluye:</h6>
                                <div class="ingredients-list">
                                    Papas Fritas Grandes + Empanaditas de Queso
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Combo Empanaditas + Papas</h5>
                            <p class="card-text">$10.990</p>
                    </div>
                </div>
                </div>

                <!-- Producto 13 -->
                <div class="col-md-4 col-sm-6 mb-4 product-card hamburguesas">
                    <div class="card h-100 text-center">
                        <div class="image-container">
                            <img src="img/productos/Hamburguesa BBQ.jpeg" class="card-img-top" alt="Hamburguesa BBQ">
                            <div class="ingredients-overlay">
                                <h6>Ingredientes:</h6>
                                <div class="ingredients-list">
                                    Pan brioche artesanal, Carne de res 150g, Queso cheddar, Tomate, Salsa BBQ casera
                                </div>
                                <div class="view-product">Ver producto</div>
                            </div>  
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Hamburguesa BBQ</h5>
                            <p class="card-text">$8.990</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- Barra de Resumen de Pedido -->
    <div id="order-summary-bar" class="hidden">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <!-- Aquí se mostrarán los productos -->
                </div>
                <div class="col-md-4 text-end">
                    <button id="go-to-cart-btn" class="btn btn-success btn-lg">
                        🛒 Ir al Carrito
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="productModal">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="row">
                        <!-- Imagen grande a la izquierda -->
                        <div class="col-md-6">
                            <img id="modalImage" src="" class="img-fluid" alt="">
                        </div>
                        <!-- Información a la derecha -->
                        <div class="col-md-6 p-4">
                            <button type="button" class="btn-close float-end" data-bs-dismiss="modal"></button>
                            <h3 id="modalTitle"></h3>
                            <h4 id="modalPrice" class="modal-price mb-2"></h4>
                            <h6 class="availability mb-3">Disponible</h6>
                            <p id="modalIngredients"></p>
                            <!-- Aquí van los extras -->
                            <div id="modalExtras"></div>
                            <button class="btn btn-primary w-100 mt-3 cart-btn">Agregar al carrito</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script>
    // Cargar navbar
    fetch("components/navbar.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("navbar-placeholder").innerHTML = data;

        // Detectar página actual y marcar enlace activo
        const currentPage = window.location.pathname.split("/").pop();
        const links = document.querySelectorAll("nav a");

        links.forEach(link => {
          const href = link.getAttribute("href");
          if (href === currentPage) {
            link.classList.add("active");
          }
        });
        // Usuario registrado?
        const perfilLink = document.getElementById('perfil-link');

        perfilLink.addEventListener('click', (e) => {
          const usuarioLogueado = localStorage.getItem('usuarioLogueado'); // ejemplo

          if (!usuarioLogueado) {
            // No está logueado → redirigir a registro
            e.preventDefault();
            window.location.href = 'register.html';
          } 
          // Si está logueado, deja que vaya a perfil_usuario.html
        });
      });

    fetch("components/footer.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("footer-placeholder").innerHTML = data;
     });

    document.addEventListener('DOMContentLoaded', function () {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const productCards = document.querySelectorAll('.product-card');
      const noProductsMessage = document.getElementById('no-products-message');
      const productsContainer = document.getElementById('products-container');
      const modalElement = document.getElementById('productModal');
      const bsModal = new bootstrap.Modal(modalElement);
      const goToCartBtn = document.getElementById('go-to-cart-btn');

      let cart = [];
      let scrollPosition = 0;
      let lastFocusedElement = null;

      /* ---------------- FILTRADO ---------------- */
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          const category = button.getAttribute('data-category');
          filterButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');

          let visibleProducts = 0;
          productCards.forEach(card => {
            if (category === 'todos' || card.classList.contains(category)) {
              card.classList.remove('hidden');
              visibleProducts++;
            } else {
              card.classList.add('hidden');
            }
          });

          if (visibleProducts === 0) {
            noProductsMessage.classList.remove('hidden');
            productsContainer.classList.add('hidden');
          } else {
            noProductsMessage.classList.add('hidden');
            productsContainer.classList.remove('hidden');
          }
        });
      });

      /* ---------- GUARDAR / RESTAURAR SCROLL Y FOCO ---------- */
      function saveScrollPosition() {
        scrollPosition = window.pageYOffset || document.documentElement.scrollTop || 0;
      }
      function restoreScrollPosition() {
        window.scrollTo(0, scrollPosition);
      }

      modalElement.addEventListener('show.bs.modal', function () {
        // guardar el elemento con foco antes de abrir (para devolverle foco después)
        lastFocusedElement = document.activeElement;
        saveScrollPosition();
      });

      modalElement.addEventListener('hidden.bs.modal', function () {
        // Limpiar posibles backdrops sobrantes y clases (sin manipular display)
        const backdrops = document.querySelectorAll('.modal-backdrop');
        backdrops.forEach(b => b.remove());
        document.body.classList.remove('modal-open');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';

        // Restaurar scroll
        restoreScrollPosition();

        // Devolver foco al elemento que abrió el modal (si es posible)
        if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          try {
            lastFocusedElement.focus({ preventScroll: true });
          } catch (e) {
            // navegadores antiguos ignoran preventScroll
            lastFocusedElement.focus();
          }
        }
      });

      /* ----------------- PRECIOS ----------------- */
      function parsePrice(priceString) {
        const digits = priceString.replace(/\D/g, ''); // quita todo lo que no sea número
        return digits ? parseInt(digits, 10) : 0;
      }
      function formatPrice(price) {
        return '$' + price.toLocaleString('es-CL');
      }

      /* --------------- CARRITO Y RESUMEN --------------- */
      function updateOrderSummary() {
        const orderBar = document.getElementById('order-summary-bar');
        const leftColumn = orderBar.querySelector('.col-md-8');

        if (cart.length === 0) {
          orderBar.classList.add('hidden');
          return;
        }

        let subtotal = 0;
        const productCount = {};
        cart.forEach(item => {
          subtotal += item.price;
          productCount[item.name] = (productCount[item.name] || 0) + 1;
        });

        let productsText = '';
        for (const [productName, quantity] of Object.entries(productCount)) {
          productsText += `${quantity}x ${productName}, `;
        }
        productsText = productsText.slice(0, -2);

        leftColumn.innerHTML = `<strong>${productsText}</strong> | Subtotal: ${formatPrice(subtotal)}`;
        orderBar.classList.remove('hidden');
      }

      function addToCart(productName, productPrice) {
        const instance = bootstrap.Modal.getInstance(modalElement);
        if (instance) instance.hide();
        cart.push({ name: productName, price: productPrice });
        updateOrderSummary();
      }

      /* --------------- ABRIR EL MODAL DESDE LA CARD --------------- */
      productCards.forEach(card => {
        // Hacer focusable la card si no lo es (recomendado: también agrega tabindex="0" en el HTML)
        if (!card.hasAttribute('tabindex')) {
          card.setAttribute('tabindex', '0');
        }

        card.addEventListener('click', function () {
          if (this.classList.contains('unavailable-product')) return;

          lastFocusedElement = this; // para devolver el foco a la card
          const title = this.querySelector('.card-title').textContent;
          
          const newPriceEl = this.querySelector('.new-price');
          const price = newPriceEl ? newPriceEl.textContent : this.querySelector('.card-text').textContent;

          const image = this.querySelector('.card-img-top').src;
          const ingredientsOverlay = this.querySelector('.ingredients-overlay');
          const ingredientsHTML = ingredientsOverlay ? ingredientsOverlay.innerHTML : '';
          const ingredients = ingredientsHTML.replace('<div class="view-product">Ver producto</div>', '');

          document.getElementById('modalTitle').textContent = title;
          document.getElementById('modalPrice').textContent = price;
          document.getElementById('modalImage').src = image;
          document.getElementById('modalIngredients').innerHTML = ingredients;

          // extras condicionales
          if (this.classList.contains('hamburguesas')) {
            document.getElementById('modalExtras').innerHTML = `
              <div class="mb-3">
                <h6>Extras disponibles:</h6>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="extraQueso">
                  <label class="form-check-label" for="extraQueso">Queso extra (+$1.000)</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="extraTocino">
                  <label class="form-check-label" for="extraTocino">Tocino extra (+$1.800)</label>
                </div>
              </div>
            `;
          } else {
            document.getElementById('modalExtras').innerHTML = '';
          }

          // configurar botón de agregar (sobrescribe onclick para evitar múltiples handlers)
          const addToCartBtn = modalElement.querySelector('.btn-primary');
          if (addToCartBtn) {
            addToCartBtn.onclick = function () {
              addToCart(title, parsePrice(price));
            };
          }

          bsModal.show();
        });

        // también permitir abrir con tecla Enter (accesibilidad)
        card.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      });

      /* --------------- BOTÓN IR AL CARRITO --------------- */
      goToCartBtn.addEventListener('click', function () {
        alert(`Redirigiendo al carrito con ${cart.length} productos`);
        console.log('Productos en el carrito:', cart);
      });
    }); // DOMContentLoaded
    </script>
</body>
</html>